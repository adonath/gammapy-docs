

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Models &mdash; gammapy v0.18.3.dev181+gb59258698</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gammapy.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/gammapy_logo.ico"/>
  
  
  
    <link rel="canonical" href="https://docs.gammapy.org/dev/tutorials/models.html"/>
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/gammapy.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Modeling and fitting" href="modeling.html" />
    <link rel="prev" title="Source catalogs" href="catalog.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> gammapy
          

          
          </a>

          
            
            
              <div class="version">
                0.18.3.dev181+gb59258698
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#workflow">Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#data-reduction">Data reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#datasets">Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#modeling-and-fitting">Modeling and Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#time-analysis">Time analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#simulation">Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#other-topics">Other topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#what-next">What next?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../overview/DL3.html">The Data Level 3 (DL3) format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html#using-anaconda">Using Anaconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html#using-other-package-managers">Using other package managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html#download-tutorials">Download tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html#what-next">What next?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install/dependencies.html">Gammapy Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install/other.html">Other package managers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install/pip.html">Installation with pip</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#help">Help!?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#check-your-setup">Check your setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#use-gammapy">Use Gammapy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started.html#id2">Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started.html#id3">IPython</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started.html#python-script">Python script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started.html#jupyter-notebooks">Jupyter notebooks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html#install-issues">Install issues</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#starting">Starting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis_1.html">High-level interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis_2.html">Low level API</a></li>
<li class="toctree-l3"><a class="reference internal" href="overview.html">Data structures</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-exploration">Data exploration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cta.html">CTA with Gammapy</a></li>
<li class="toctree-l3"><a class="reference internal" href="hess.html">H.E.S.S. with Gammapy</a></li>
<li class="toctree-l3"><a class="reference internal" href="fermi_lat.html">Fermi-LAT with Gammapy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-analysis">Data analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#d-spectral">1D Spectral</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#d-image">2D Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#d-cube">3D Cube</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#time">Time</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#advanced">Advanced</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html#package">Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#specific-use-cases">Specific use cases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#scripts">Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="survey_map.html">Survey map</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../howto.html">How To</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#access-iact-data">Access IACT data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#check-irfs">Check IRFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#use-gammapy-for-modeling-2d-images">Use gammapy for modeling 2D images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#extract-1d-spectra">Extract 1D spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#extract-a-lightcurve">Extract a lightcurve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#compute-source-significance">Compute source significance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#compute-cumulative-significance">Compute cumulative significance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#detect-sources-in-a-map">Detect sources in a map</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#astrophysical-source-modeling">Astrophysical source modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#implement-a-custom-model">Implement a custom model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto.html#energy-dependent-spatial-models">Energy Dependent Spatial Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Glossary and references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../references.html#glossary">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references.html#publications">Publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references.html#other-gamma-ray-packages">Other gamma-ray packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../references.html#other-useful-packages">Other useful packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#unreleased">0.19 (unreleased)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-19th-2020">0.18.2 (Nov 19th, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#pull-requests">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-6th-2020">0.18.1 (Nov 6th, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id2">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-4th-2020">0.18 (Nov 4th, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id3">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#apr-1-2020">0.17 (Apr 1, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#summary">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id4">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#feb-1-2020">0.16 (Feb 1, 2020)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id5">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id6">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#dec-3-2019">0.15 (Dec 3, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id7">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id8">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#sep-30-2019">0.14 (Sep 30, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id9">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id10">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#jul-26-2019">0.13 (Jul 26, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id11">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id12">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#may-30-2019">0.12 (May 30, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id13">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id14">Pull Requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#mar-29-2019">0.11 (Mar 29, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id15">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id16">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#jan-28-2019">0.10 (Jan 28, 2019)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id17">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id18">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-29-2018">0.9 (Nov 29, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id19">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id20">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#sep-23-2018">0.8 (Sep 23, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id21">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id22">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#feb-28-2018">0.7 (Feb 28, 2018)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id23">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id24">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#apr-28-2017">0.6 (Apr 28, 2017)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id25">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id26">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#nov-22-2016">0.5 (Nov 22, 2016)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id27">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id28">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#apr-20-2016">0.4 (Apr 20, 2016)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id29">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id30">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#aug-13-2015">0.3 (Aug 13, 2015)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id31">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id32">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#apr-13-2015">0.2 (Apr 13, 2015)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id33">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id34">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../changelog.html#aug-25-2014">0.1 (Aug 25, 2014)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id35">Summary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog.html#id36">Pull requests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Gammapy Package</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../analysis/index.html">analysis - High-level interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../analysis/index.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#using-the-high-level-interface">Using the high-level interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../analysis/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../analysis/index.html#module-gammapy.analysis">gammapy.analysis Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">data - DL3 data access and observations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html#using-gammapy-data">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.data</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../data/index.html#module-gammapy.data">gammapy.data Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../makers/index.html">makers - Data reduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#safe-data-range-handling">Safe Data Range Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#stacking-of-datasets">Stacking of Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#combining-data-reduction-steps">Combining Data Reduction Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../makers/reflected.html">Reflected regions background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../makers/ring.html">Ring background</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#using-gammapy-makers">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.makers</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../makers/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../makers/index.html#module-gammapy.makers">gammapy.makers Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../datasets/index.html">datasets - Reduced datasets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../datasets/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datasets/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../datasets/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../datasets/index.html#module-gammapy.datasets">gammapy.datasets Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modeling/index.html">modeling - Models and fitting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modeling/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modeling/index.html#tutorials">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modeling/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modeling/index.html#module-gammapy.modeling">gammapy.modeling Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modeling/index.html#module-gammapy.modeling.models">gammapy.modeling.models Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../estimators/index.html">estimators - High level estimators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../estimators/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../estimators/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../estimators/detect.html">Flux and significance maps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../estimators/index.html#tutorials">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../estimators/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../estimators/index.html#module-gammapy.estimators">gammapy.estimators Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../irf/index.html">irf - Instrument response functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../irf/index.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../irf/index.html#irf-axis-naming">IRF Axis naming</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../irf/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../irf/index.html#using-gammapy-irf">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.irf</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../irf/theory.html">IRF Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../irf/aeff.html">Effective area</a></li>
<li class="toctree-l3"><a class="reference internal" href="../irf/edisp.html">Energy Dispersion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../irf/psf.html">Point Spread Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../irf/bkg.html">Background</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../irf/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../irf/index.html#module-gammapy.irf">gammapy.irf Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../maps/index.html">maps - Sky maps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#constructing-with-factory-methods">Constructing with Factory Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#indexing-and-slicing">Indexing and Slicing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#accessor-methods">Accessor Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#interface-with-mapcoord-and-skycoord">Interface with <code class="xref py py-obj docutils literal notranslate"><span class="pre">MapCoord</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">SkyCoord</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#differential-and-integral-maps">Differential and integral maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#mapcoord">MapCoord</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#interpolation">Interpolation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#iterating-by-image">Iterating by image</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#fits-i-o">FITS I/O</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#visualization">Visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#creating-counts-cubes-from-event-lists">Creating counts cubes from event lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#generating-a-cutout-of-a-model-cube">Generating a Cutout of a Model Cube</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#using-gammapy-maps">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.maps</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../maps/hpxmap.html">HEALPix-based Maps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../maps/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../maps/index.html#module-gammapy.maps">gammapy.maps Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../catalog/index.html">catalog - Source catalogs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#tutorials">Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../catalog/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../catalog/index.html#module-gammapy.catalog">gammapy.catalog Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../astro/index.html">astro - Astrophysics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../astro/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../astro/index.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../astro/index.html#sub-packages">Sub-packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../astro/source/index.html">Astrophysical source models (<code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.astro.source</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../astro/population/index.html">Astrophysical source population models (<code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.astro.population</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../astro/darkmatter/index.html">Dark matter (<code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.astro.darkmatter</span></code>)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/index.html">scripts - Command line tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html#execute">Execute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html#running-config-driven-data-reduction">Running config driven data reduction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#write-your-own-cli">Write your own CLI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html#command-not-found">Command not found</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../scripts/index.html#reference">Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../scripts/index.html#gammapy">gammapy</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../stats/index.html">stats - Statistics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../stats/index.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#notations">Notations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#counts-and-fit-statistics">Counts and fit statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#estimating-ts">Estimating TS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../stats/index.html#counts-statistics-classes">Counts statistics classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#cash-counts-statistic">Cash counts statistic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#wstat-counts-statistic">WStat counts statistic</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../stats/index.html#using-gammapy-stats">Using <code class="xref py py-obj docutils literal notranslate"><span class="pre">gammapy.stats</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../stats/fit_statistics.html">Fit statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../stats/wstat_derivation.html">Derivation of the WStat formula</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../stats/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../stats/index.html#module-gammapy.stats">gammapy.stats Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/index.html">visualization - Plotting and Visualization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualization/index.html#getting-started">Getting Started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visualization/index.html#colormaps">Colormaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../visualization/index.html#survey-panel-plots">Survey Panel Plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../visualization/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../visualization/index.html#module-gammapy.visualization">gammapy.visualization Package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utils/index.html">utils - Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#time-handling-in-gammapy">Time handling in Gammapy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#time-format-and-scale">Time format and scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#mission-elapsed-times-met">Mission elapsed times (MET)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#time-differences">Time differences</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../utils/index.html#reference-api">Reference/API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.units">gammapy.utils.units Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.coordinates">gammapy.utils.coordinates Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.integrate">gammapy.utils.integrate Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.interpolation">gammapy.utils.interpolation Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.table">gammapy.utils.table Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.fits">gammapy.utils.fits Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.random">gammapy.utils.random Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.regions">gammapy.utils.regions Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.scripts">gammapy.utils.scripts Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.testing">gammapy.utils.testing Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.nddata">gammapy.utils.nddata Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utils/index.html#module-gammapy.utils.time">gammapy.utils.time Module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Developer documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../development/intro.html">How to contribute to Gammapy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/setup.html">Gammapy project setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/howto.html">Developer HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/release.html">How to make a Gammapy release</a></li>
<li class="toctree-l2"><a class="reference internal" href="../development/pigs/index.html">PIGs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-001.html">PIG 1 - PIG purpose and guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-002.html">PIG 2 - Organization of low-level analysis code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-003.html">PIG 3 - Plan for dropping Python 2.7 support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-004.html">PIG 4 - Setup for tutorial notebooks and data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-005.html">PIG 5 - Gammapy 1.0 Roadmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-006.html">PIG 6 - CTA observation handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-007.html">PIG 7 - Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-008.html">PIG 8 - Datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-009.html">PIG 9 - Event Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-010.html">PIG 10 - Regions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-011.html">PIG 11 - Light curves</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-012.html">PIG 12 - High-level interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-013.html">PIG 13 - Gammapy dependencies and distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-014.html">PIG 14 - Uncertainty estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-016.html">PIG 16 - Gammapy package structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-018.html">PIG 18 - Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-019.html">PIG 19 - Gammapy package structure follow up</a></li>
<li class="toctree-l3"><a class="reference internal" href="../development/pigs/pig-021.html">PIG 21 - Models Improvements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../development/dataformats.html">Data Formats</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">gammapy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/models.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
<p class="admonition-title fa fa-exclamation-circle"><strong>This is a fixed-text formatted version of a Jupyter notebook</strong></p>
<ul class="simple">
<li><p>Try online <a class="reference external" href="https://mybinder.org/v2/gh/gammapy/gammapy-webpage/master?urlpath=lab/tree/models.ipynb"><img alt="Binder" src="https://static.mybinder.org/badge.svg" /></a></p></li>
<li><p>You can contribute with your own notebooks in this <a class="reference external" href="https://github.com/gammapy/gammapy/tree/master/docs/tutorials">GitHub repository</a>.</p></li>
<li><p><strong>Source files:</strong> <a class="reference external" href="../_static/notebooks/models.ipynb">models.ipynb</a> | <a class="reference external" href="../_static/notebooks/models.py">models.py</a></p></li>
</ul>
</div>
<div class="section" id="Models">
<h1>Models<a class="headerlink" href="#Models" title="Permalink to this headline">¶</a></h1>
<p>This is an introduction and overview on how to work with models in Gammapy.</p>
<p>The sub-package <code class="docutils literal notranslate"><a href='../modeling/index.html'>gammapy.modeling</a></code> contains all the functionality related to modeling and fitting data. This includes spectral, spatial and temporal model classes, as well as the fit and parameter API. We will cover the follwing topics in order:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Spectral-Models">Spectral Models</a></p></li>
<li><p><a class="reference external" href="#Spatial-Models">Spatial Models</a></p></li>
<li><p><a class="reference external" href="#SkyModel">SkyModel</a></p></li>
<li><p><a class="reference external" href="#Model-Lists-and-Serialisation">Model Lists and Serialisation</a></p></li>
<li><p><a class="reference external" href="#Implementing-a-Custom-Model">Implementing as Custom Model</a></p></li>
</ol>
<p>The models follow a naming scheme which contains the category as a suffix to the class name. An overview of all the available models can be found in the <a class="reference external" href="..\/modeling/gallery/index.html#spectral-models">model gallery</a>.</p>
<p>Note that there is a separate tutorial <a class="reference internal" href="modeling.html"><span class="doc">modeling</span></a> that explains about <code class="docutils literal notranslate"><a href='../modeling/index.html'>gammapy.modeling</a></code>, the Gammapy modeling and fitting framework. You have to read that to learn how to work with models in order to analyse data.</p>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">gammapy.maps</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">WcsGeom</span><span class="p">,</span> <span class="n">MapAxis</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Spectral-models">
<h2>Spectral models<a class="headerlink" href="#Spectral-models" title="Permalink to this headline">¶</a></h2>
<p>All models are imported from the <code class="docutils literal notranslate"><a href='../modeling/index.html#module-gammapy.modeling.models'>gammapy.modeling.models</a></code> namespace. Let’s start with a <code class="docutils literal notranslate"><span class="pre">PowerLawSpectralModel</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">PowerLawSpectralModel</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pwl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PowerLawSpectralModel

   name     value         unit      min max frozen   error
--------- ---------- -------------- --- --- ------ ---------
    index 2.0000e+00                nan nan  False 0.000e+00
amplitude 1.0000e-12 cm-2 s-1 TeV-1 nan nan  False 0.000e+00
reference 1.0000e+00            TeV nan nan   True 0.000e+00
</pre></div></div>
</div>
<p>To get a list of all available spectral models you can import and print the spectral model registry or take a look at the <a class="reference external" href="..\/modeling/gallery/index.html#spectral-models">model gallery</a>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SPECTRAL_MODEL_REGISTRY</span>

<span class="nb">print</span><span class="p">(</span><span class="n">SPECTRAL_MODEL_REGISTRY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Registry
--------

ConstantSpectralModel                  : [&#39;ConstantSpectralModel&#39;, &#39;const&#39;]
CompoundSpectralModel                  : [&#39;CompoundSpectralModel&#39;, &#39;compound&#39;]
PowerLawSpectralModel                  : [&#39;PowerLawSpectralModel&#39;, &#39;pl&#39;]
PowerLaw2SpectralModel                 : [&#39;PowerLaw2SpectralModel&#39;, &#39;pl-2&#39;]
BrokenPowerLawSpectralModel            : [&#39;BrokenPowerLawSpectralModel&#39;, &#39;bpl&#39;]
SmoothBrokenPowerLawSpectralModel      : [&#39;SmoothBrokenPowerLawSpectralModel&#39;, &#39;sbpl&#39;]
PiecewiseNormSpectralModel             : [&#39;PiecewiseNormSpectralModel&#39;, &#39;piecewise-norm&#39;]
ExpCutoffPowerLawSpectralModel         : [&#39;ExpCutoffPowerLawSpectralModel&#39;, &#39;ecpl&#39;]
ExpCutoffPowerLaw3FGLSpectralModel     : [&#39;ExpCutoffPowerLaw3FGLSpectralModel&#39;, &#39;ecpl-3fgl&#39;]
SuperExpCutoffPowerLaw3FGLSpectralModel: [&#39;SuperExpCutoffPowerLaw3FGLSpectralModel&#39;, &#39;secpl-3fgl&#39;]
SuperExpCutoffPowerLaw4FGLSpectralModel: [&#39;SuperExpCutoffPowerLaw4FGLSpectralModel&#39;, &#39;secpl-4fgl&#39;]
LogParabolaSpectralModel               : [&#39;LogParabolaSpectralModel&#39;, &#39;lp&#39;]
TemplateSpectralModel                  : [&#39;TemplateSpectralModel&#39;, &#39;template&#39;]
GaussianSpectralModel                  : [&#39;GaussianSpectralModel&#39;, &#39;gauss&#39;]
EBLAbsorptionNormSpectralModel         : [&#39;EBLAbsorptionNormSpectralModel&#39;, &#39;ebl-norm&#39;]
NaimaSpectralModel                     : [&#39;NaimaSpectralModel&#39;, &#39;naima&#39;]
ScaleSpectralModel                     : [&#39;ScaleSpectralModel&#39;, &#39;scale&#39;]
PowerLawNormSpectralModel              : [&#39;PowerLawNormSpectralModel&#39;, &#39;pl-norm&#39;]
LogParabolaNormSpectralModel           : [&#39;LogParabolaNormSpectralModel&#39;, &#39;lp-norm&#39;]
ExpCutoffPowerLawNormSpectralModel     : [&#39;ExpCutoffPowerLawNormSpectralModel&#39;, &#39;ecpl-norm&#39;]

</pre></div></div>
</div>
<p>Spectral models all come with default parameters. Different parameter values can be passed on creation of the model, either as a string defining the value and unit or as an <code class="docutils literal notranslate"><span class="pre">astropy.units.Quantity</span></code> object directly:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">amplitude</span> <span class="o">=</span> <span class="mf">1e-12</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;TeV-1 cm-2 s-1&quot;</span><span class="p">)</span>
<span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For convenience a <code class="docutils literal notranslate"><span class="pre">str</span></code> specifying the value and unit can be passed as well:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="s2">&quot;2.7e-12 TeV-1 cm-2 s-1&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pwl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PowerLawSpectralModel

   name     value         unit      min max frozen   error
--------- ---------- -------------- --- --- ------ ---------
    index 2.2000e+00                nan nan  False 0.000e+00
amplitude 2.7000e-12 cm-2 s-1 TeV-1 nan nan  False 0.000e+00
reference 1.0000e+00            TeV nan nan   True 0.000e+00
</pre></div></div>
</div>
<p>The model can be evaluated at given energies by calling the model instance:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">dnde</span> <span class="o">=</span> <span class="n">pwl</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dnde</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[2.70000000e-12 2.40822469e-13 1.70358483e-14 1.51948705e-15] 1 / (cm2 s TeV)
</pre></div></div>
</div>
<p>The returned quantity is a differential photon flux.</p>
<p>For spectral models you can computed in addition the integrated and energy flux in a given energy range:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">flux</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="n">energy_min</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>

<span class="n">eflux</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">energy_flux</span><span class="p">(</span><span class="n">energy_min</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">eflux</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2.108034597491956e-12 1 / (cm2 s)
4.982075849517389e-12 TeV / (cm2 s)
</pre></div></div>
</div>
<p>This also works for a list or an array of integration boundaries:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="n">energy_min</span><span class="o">=</span><span class="n">energy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">energy_max</span><span class="o">=</span><span class="n">energy</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1.64794383e-12 4.60090769e-13 1.03978226e-13] 1 / (cm2 s)
</pre></div></div>
</div>
<p>In some cases it can be useful to find use the inverse of a spectral model, to find the energy at which a given flux is reached:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dnde</span> <span class="o">=</span> <span class="mf">2.7e-12</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;TeV-1 cm-2 s-1&quot;</span><span class="p">)</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">dnde</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.0 TeV
</pre></div></div>
</div>
<p>As a convenience you can also plot any spectral model in a given energy range:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pwl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/gammapy/modeling/models/spectral.py:401: MatplotlibDeprecationWarning: The &#39;nonposx&#39; parameter of __init__() has been renamed &#39;nonpositive&#39; since Matplotlib 3.3; support for the old name will be dropped two minor releases later.
  ax.set_xscale(&#34;log&#34;, nonposx=&#34;clip&#34;)
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/gammapy/modeling/models/spectral.py:402: MatplotlibDeprecationWarning: The &#39;nonposy&#39; parameter of __init__() has been renamed &#39;nonpositive&#39; since Matplotlib 3.3; support for the old name will be dropped two minor releases later.
  ax.set_yscale(&#34;log&#34;, nonposy=&#34;clip&#34;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:xlabel=&#39;Energy [TeV]&#39;, ylabel=&#39;Flux [1 / (cm2 s TeV)]&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_models_23_2.png" src="../_images/tutorials_models_23_2.png" />
</div>
</div>
</div>
<div class="section" id="Spatial-models">
<h2>Spatial models<a class="headerlink" href="#Spatial-models" title="Permalink to this headline">¶</a></h2>
<p>Spatial models are imported from the same <code class="docutils literal notranslate"><a href='../modeling/index.html#module-gammapy.modeling.models'>gammapy.modeling.models</a></code> namespace, let’s start with a <code class="docutils literal notranslate"><span class="pre">GaussianSpatialModel</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">GaussianSpatialModel</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gauss</span> <span class="o">=</span> <span class="n">GaussianSpatialModel</span><span class="p">(</span><span class="n">lon_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;0.2 deg&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gauss</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GaussianSpatialModel

 name   value    unit    min        max    frozen   error
----- ---------- ---- ---------- --------- ------ ---------
lon_0 0.0000e+00  deg        nan       nan  False 0.000e+00
lat_0 0.0000e+00  deg -9.000e+01 9.000e+01  False 0.000e+00
sigma 2.0000e-01  deg  0.000e+00       nan  False 0.000e+00
    e 0.0000e+00       0.000e+00 1.000e+00   True 0.000e+00
  phi 0.0000e+00  deg        nan       nan   True 0.000e+00
</pre></div></div>
</div>
<p>Again you can check the <code class="docutils literal notranslate"><span class="pre">SPATIAL_MODELS</span></code> registry to see which models are available or take a look at the <a class="reference external" href="..\/modeling/gallery/index.html#spatial-models">model gallery</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SPATIAL_MODEL_REGISTRY</span>

<span class="nb">print</span><span class="p">(</span><span class="n">SPATIAL_MODEL_REGISTRY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Registry
--------

ConstantSpatialModel           : [&#39;ConstantSpatialModel&#39;, &#39;const&#39;]
TemplateSpatialModel           : [&#39;TemplateSpatialModel&#39;, &#39;template&#39;]
DiskSpatialModel               : [&#39;DiskSpatialModel&#39;, &#39;disk&#39;]
GaussianSpatialModel           : [&#39;GaussianSpatialModel&#39;, &#39;gauss&#39;]
GeneralizedGaussianSpatialModel: [&#39;GeneralizedGaussianSpatialModel&#39;, &#39;gauss-general&#39;]
PointSpatialModel              : [&#39;PointSpatialModel&#39;, &#39;point&#39;]
ShellSpatialModel              : [&#39;ShellSpatialModel&#39;, &#39;shell&#39;]

</pre></div></div>
</div>
<p>The default coordinate frame for all spatial models is <code class="docutils literal notranslate"><span class="pre">&quot;icrs&quot;</span></code>, but the frame can be modified using the <code class="docutils literal notranslate"><span class="pre">frame</span></code> argument:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gauss</span> <span class="o">=</span> <span class="n">GaussianSpatialModel</span><span class="p">(</span>
    <span class="n">lon_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;0.2 deg&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can specify any valid <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> frame. The center position of the model can be retrieved as a <code class="docutils literal notranslate"><span class="pre">astropy.coordinates.SkyCoord</span></code> object using <code class="docutils literal notranslate"><span class="pre">SpatialModel.position</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">gauss</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;SkyCoord (Galactic): (l, b) in deg
    (0., 0.)&gt;
</pre></div></div>
</div>
<p>Spatial models can be evaluated again by calling the instance:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lon</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">lat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>

<span class="n">flux_per_omega</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flux_per_omega</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[13061.88470839 10172.60603928] 1 / sr
</pre></div></div>
</div>
<p>The returned quantity corresponds to a surface brightness. Spatial model can be also evaluated using <code class="docutils literal notranslate"><a href='../api/gammapy.maps.Map.html#gammapy.maps.Map'>gammapy.maps.Map</a></code> and <code class="docutils literal notranslate"><a href='../api/gammapy.maps.Geom.html#gammapy.maps.Geom'>gammapy.maps.Geom</a></code> objects:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">gauss</span><span class="o">.</span><span class="n">evaluate_geom</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;Figure size 432x288 with 2 Axes&gt;,
 &lt;WCSAxesSubplot:xlabel=&#39;Galactic Longitude&#39;, ylabel=&#39;Galactic Latitude&#39;&gt;,
 &lt;matplotlib.colorbar.Colorbar at 0x7f96d3fbe5f8&gt;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_models_37_1.png" src="../_images/tutorials_models_37_1.png" />
</div>
</div>
<p>Again for convenience the model can be plotted directly:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gauss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;WCSAxesSubplot:xlabel=&#39;Galactic Longitude&#39;, ylabel=&#39;Galactic Latitude&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_models_39_1.png" src="../_images/tutorials_models_39_1.png" />
</div>
</div>
<p>All spatial models have an associated sky region to it e.g. to illustrate the extend of the model on a sky image. The returned object is an <code class="docutils literal notranslate"><span class="pre">regions.SkyRegion</span></code> object:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">gauss</span><span class="o">.</span><span class="n">to_region</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Region: EllipseSkyRegion
center: &lt;SkyCoord (Galactic): (l, b) in deg
    (0., 0.)&gt;
width: 0.4 deg
height: 0.4 deg
angle: 0.0 deg
</pre></div></div>
</div>
<p>Now we can plot the region on an sky image:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create and plot the model</span>
<span class="n">gauss_elongated</span> <span class="o">=</span> <span class="n">GaussianSpatialModel</span><span class="p">(</span>
    <span class="n">lon_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;0.2 deg&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="s2">&quot;45 deg&quot;</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">gauss_elongated</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># add region illustration</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">gauss_elongated</span><span class="o">.</span><span class="n">to_region</span><span class="p">()</span>
<span class="n">region_pix</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">to_pixel</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">region_pix</span><span class="o">.</span><span class="n">as_artist</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.patches.Ellipse at 0x7f96d3e62be0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_models_43_1.png" src="../_images/tutorials_models_43_1.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.to_region()</span></code> method can also be useful to write e.g. ds9 region files using <code class="docutils literal notranslate"><span class="pre">write_ds9</span></code> from the <code class="docutils literal notranslate"><span class="pre">regions</span></code> package:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">regions</span> <span class="kn">import</span> <span class="n">write_ds9</span>

<span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">gauss</span><span class="o">.</span><span class="n">to_region</span><span class="p">(),</span> <span class="n">gauss_elongated</span><span class="o">.</span><span class="n">to_region</span><span class="p">()]</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;regions.reg&quot;</span>
<span class="n">write_ds9</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">coordsys</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.4f&quot;</span><span class="p">,</span> <span class="n">radunit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>cat regions.reg
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# Region file format: DS9 astropy/regions
galactic
ellipse(0.0000,0.0000,0.2000,0.2000,0.0000)
ellipse(96.3373,-60.1886,0.1428,0.2000,45.0000)
</pre></div></div>
</div>
</div>
<div class="section" id="SkyModel">
<h2>SkyModel<a class="headerlink" href="#SkyModel" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><a href='../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel'>gammapy.modeling.models.SkyModel</a></code> class combines a spectral and a spatial model. It can be created from existing spatial and spectral model components:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SkyModel</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><span class="n">pwl</span><span class="p">,</span> <span class="n">spatial_model</span><span class="o">=</span><span class="n">gauss</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-source&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SkyModel

  Name                      : my-source
  Datasets names            : None
  Spectral model type       : PowerLawSpectralModel
  Spatial  model type       : GaussianSpatialModel
  Temporal model type       :
  Parameters:
    index                   :   2.200
    amplitude               :   2.70e-12  1 / (cm2 s TeV)
    reference    (frozen)   :   1.000  TeV
    lon_0                   :   0.000  deg
    lat_0                   :   0.000  deg
    sigma                   :   0.200  deg
    e            (frozen)   :   0.000
    phi          (frozen)   :   0.000  deg


</pre></div></div>
</div>
<p>It is good practice to specify a name for your sky model, so that you can access it later by name and have meaningful identifier you serilisation. If you don’t define a name, a unique random name is generated:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_without_name</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><span class="n">pwl</span><span class="p">,</span> <span class="n">spatial_model</span><span class="o">=</span><span class="n">gauss</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_without_name</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
BUUdXL5P
</pre></div></div>
</div>
<p>The spectral and spatial component of the source model can be accessed using <code class="docutils literal notranslate"><span class="pre">.spectral_model</span></code> and <code class="docutils literal notranslate"><span class="pre">.spatial_model</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;gammapy.modeling.models.spectral.PowerLawSpectralModel at 0x7f96d47755f8&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">spatial_model</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;gammapy.modeling.models.spatial.GaussianSpatialModel at 0x7f96d4408b38&gt;
</pre></div></div>
</div>
<p>And can be used as you have seen already seen above:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/gammapy/modeling/models/spectral.py:401: MatplotlibDeprecationWarning: The &#39;nonposx&#39; parameter of __init__() has been renamed &#39;nonpositive&#39; since Matplotlib 3.3; support for the old name will be dropped two minor releases later.
  ax.set_xscale(&#34;log&#34;, nonposx=&#34;clip&#34;)
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/gammapy/modeling/models/spectral.py:402: MatplotlibDeprecationWarning: The &#39;nonposy&#39; parameter of __init__() has been renamed &#39;nonpositive&#39; since Matplotlib 3.3; support for the old name will be dropped two minor releases later.
  ax.set_yscale(&#34;log&#34;, nonposy=&#34;clip&#34;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:xlabel=&#39;Energy [TeV]&#39;, ylabel=&#39;Flux [1 / (cm2 s TeV)]&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_models_56_2.png" src="../_images/tutorials_models_56_2.png" />
</div>
</div>
<p>In some cases (e.g. when doing a spectral analysis) there is only a spectral model associated with the source. So the spatial model is optional:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_spectrum</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><span class="n">pwl</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;source-spectrum&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_spectrum</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SkyModel

  Name                      : source-spectrum
  Datasets names            : None
  Spectral model type       : PowerLawSpectralModel
  Spatial  model type       :
  Temporal model type       :
  Parameters:
    index                   :   2.200
    amplitude               :   2.70e-12  1 / (cm2 s TeV)
    reference    (frozen)   :   1.000  TeV


</pre></div></div>
</div>
<p>Additionally the spatial model of <code class="docutils literal notranslate"><a href='../api/gammapy.modeling.models.SkyModel.html#gammapy.modeling.models.SkyModel'>gammapy.modeling.models.SkyModel</a></code> can be used to represent source models based on templates, where the spatial and energy axes are correlated. It can be created e.g. from an existing FITS file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">TemplateSpatialModel</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">PowerLawNormSpectralModel</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">diffuse_cube</span> <span class="o">=</span> <span class="n">TemplateSpatialModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/gll_iem_v06_gc.fits.gz&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">diffuse</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">PowerLawNormSpectralModel</span><span class="p">(),</span> <span class="n">diffuse_cube</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">diffuse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SkyModel

  Name                      : R9XrDcHM
  Datasets names            : None
  Spectral model type       : PowerLawNormSpectralModel
  Spatial  model type       : TemplateSpatialModel
  Temporal model type       :
  Parameters:
    norm                    :   1.000
    tilt         (frozen)   :   0.000
    reference    (frozen)   :   1.000  TeV


</pre></div></div>
</div>
<p>Note that if the spatial model is not normalized over the sky it has to be combined with a normalized spectral model, for example <code class="docutils literal notranslate"><a href='../api/gammapy.modeling.models.PowerLawNormSpectralModel.html#gammapy.modeling.models.PowerLawNormSpectralModel'>gammapy.modeling.models.PowerLawNormSpectralModel</a></code>. This is the only case in <code class="docutils literal notranslate"><span class="pre">gammapy.models.SkyModel</span></code> where the unit is fully attached to the spatial model.</p>
</div>
<div class="section" id="Model-lists-and-serialisation">
<h2>Model lists and serialisation<a class="headerlink" href="#Model-lists-and-serialisation" title="Permalink to this headline">¶</a></h2>
<p>In a typical analysis scenario a model consists of mutiple model components, or a “catalog” or “source library”. To handle this list of multiple model components, Gammapy has a <code class="docutils literal notranslate"><span class="pre">Models</span></code> class:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">Models</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">([</span><span class="n">model</span><span class="p">,</span> <span class="n">diffuse</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Models

Component 0: SkyModel

  Name                      : my-source
  Datasets names            : None
  Spectral model type       : PowerLawSpectralModel
  Spatial  model type       : GaussianSpatialModel
  Temporal model type       :
  Parameters:
    index                   :   2.200
    amplitude               :   2.70e-12  1 / (cm2 s TeV)
    reference    (frozen)   :   1.000  TeV
    lon_0                   :   0.000  deg
    lat_0                   :   0.000  deg
    sigma                   :   0.200  deg
    e            (frozen)   :   0.000
    phi          (frozen)   :   0.000  deg

Component 1: SkyModel

  Name                      : R9XrDcHM
  Datasets names            : None
  Spectral model type       : PowerLawNormSpectralModel
  Spatial  model type       : TemplateSpatialModel
  Temporal model type       :
  Parameters:
    norm                    :   1.000
    tilt         (frozen)   :   0.000
    reference    (frozen)   :   1.000  TeV


</pre></div></div>
</div>
<p>Individual model components in the list can be accessed by their name:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="s2">&quot;my-source&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SkyModel

  Name                      : my-source
  Datasets names            : None
  Spectral model type       : PowerLawSpectralModel
  Spatial  model type       : GaussianSpatialModel
  Temporal model type       :
  Parameters:
    index                   :   2.200
    amplitude               :   2.70e-12  1 / (cm2 s TeV)
    reference    (frozen)   :   1.000  TeV
    lon_0                   :   0.000  deg
    lat_0                   :   0.000  deg
    sigma                   :   0.200  deg
    e            (frozen)   :   0.000
    phi          (frozen)   :   0.000  deg


</pre></div></div>
</div>
<p><strong>Note:</strong>To make the access by name unambiguous, models are required to have a unique name, otherwise an error will be thrown.</p>
<p>To see which models are available you can use the <code class="docutils literal notranslate"><span class="pre">.names</span></code> attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;my-source&#39;, &#39;R9XrDcHM&#39;]
</pre></div></div>
</div>
<p>Note that a <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> object can be evaluated for a given longitude, latitude, and energy, but the <code class="docutils literal notranslate"><span class="pre">Models</span></code> object cannot. This <code class="docutils literal notranslate"><span class="pre">Models</span></code> container object will be assigned to <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> or <code class="docutils literal notranslate"><span class="pre">Datasets</span></code> together with the data to be fitted as explained in other analysis tutorials (see for example the <a class="reference internal" href="modeling.html"><span class="doc">modeling</span></a> notebook).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Models</span></code> class also has in place <code class="docutils literal notranslate"><span class="pre">.append()</span></code> and <code class="docutils literal notranslate"><span class="pre">.extend()</span></code> methods:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_copy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-source-copy&quot;</span><span class="p">)</span>
<span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_copy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This list of models can be also serialised to a custom YAML based format:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">models_yaml</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">models_yaml</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
components:
-   name: my-source
    type: SkyModel
    spectral:
        type: PowerLawSpectralModel
        parameters:
        -   name: index
            value: 2.2
        -   name: amplitude
            value: 2.7e-12
            unit: cm-2 s-1 TeV-1
        -   name: reference
            value: 1.0
            unit: TeV
            frozen: true
    spatial:
        type: GaussianSpatialModel
        frame: galactic
        parameters:
        -   name: lon_0
            value: 0.0
            unit: deg
        -   name: lat_0
            value: 0.0
            unit: deg
        -   name: sigma
            value: 0.2
            unit: deg
        -   name: e
            value: 0.0
            frozen: true
        -   name: phi
            value: 0.0
            unit: deg
            frozen: true
-   name: R9XrDcHM
    type: SkyModel
    spectral:
        type: PowerLawNormSpectralModel
        parameters:
        -   name: norm
            value: 1.0
        -   name: tilt
            value: 0.0
            frozen: true
        -   name: reference
            value: 1.0
            unit: TeV
            frozen: true
    spatial:
        type: TemplateSpatialModel
        frame: galactic
        parameters: []
        filename: /home/runner/work/gammapy-docs/gammapy-docs/gammapy-datasets/fermi-3fhl-gc/gll_iem_v06_gc.fits.gz
        normalize: false
        unit: 1 / (cm2 MeV s sr)
-   name: my-source-copy
    type: SkyModel
    spectral:
        type: PowerLawSpectralModel
        parameters:
        -   name: index
            value: 2.2
        -   name: amplitude
            value: 2.7e-12
            unit: cm-2 s-1 TeV-1
        -   name: reference
            value: 1.0
            unit: TeV
            frozen: true
    spatial:
        type: GaussianSpatialModel
        frame: galactic
        parameters:
        -   name: lon_0
            value: 0.0
            unit: deg
        -   name: lat_0
            value: 0.0
            unit: deg
        -   name: sigma
            value: 0.2
            unit: deg
        -   name: e
            value: 0.0
            frozen: true
        -   name: phi
            value: 0.0
            unit: deg
            frozen: true

</pre></div></div>
</div>
<p>The structure of the yaml files follows the structure of the python objects. The <code class="docutils literal notranslate"><span class="pre">components</span></code> listed correspond to the <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> and <code class="docutils literal notranslate"><span class="pre">SkyDiffuseCube</span></code> components of the <code class="docutils literal notranslate"><span class="pre">Models</span></code>. For each <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> we have informations about its <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> (corresponding to the tag attribute) and sub-mobels (i.e <code class="docutils literal notranslate"><span class="pre">spectral</span></code> model and eventually <code class="docutils literal notranslate"><span class="pre">spatial</span></code> model). Then the spatial and spectral models are defiend by their type and parameters. The <code class="docutils literal notranslate"><span class="pre">parameters</span></code> keys name/value/unit are
mandatory, while the keys min/max/frozen are optionnals (so you can prepare shorter files).</p>
<p>If you want to write this list of models to disk and read it back later you can use:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">models</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;models.yaml&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">models_read</span> <span class="o">=</span> <span class="n">Models</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;models.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Additionally the models can exported and imported togeter with the data using the <code class="docutils literal notranslate"><span class="pre">Datasets.read()</span></code> and <code class="docutils literal notranslate"><span class="pre">Datasets.write()</span></code> methods as shown in the <a class="reference internal" href="analysis_mwl.html"><span class="doc">analysis_mwl</span></a> notebook.</p>
</div>
<div class="section" id="Implementing-a-custom-model">
<h2>Implementing a custom model<a class="headerlink" href="#Implementing-a-custom-model" title="Permalink to this headline">¶</a></h2>
<p>In order to add a user defined spectral model you have to create a SpectralModel subclass. This new model class should include:</p>
<ul class="simple">
<li><p>a tag used for serialization (it can be the same as the class name)</p></li>
<li><p>an instantiation of each Parameter with their unit, default values and frozen status</p></li>
<li><p>the evaluate function where the mathematical expression for the model is defined.</p></li>
</ul>
<p>As an example we will use a PowerLawSpectralModel plus a Gaussian (with fixed width). First we define the new custom model class that we name <code class="docutils literal notranslate"><span class="pre">MyCustomSpectralModel</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SpectralModel</span><span class="p">,</span> <span class="n">Parameter</span>


<span class="k">class</span> <span class="nc">MyCustomSpectralModel</span><span class="p">(</span><span class="n">SpectralModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;My custom spectral model, parametrising a power law plus a Gaussian spectral line.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    amplitude : `astropy.units.Quantity`</span>
<span class="sd">        Amplitude of the spectra model.</span>
<span class="sd">    index : `astropy.units.Quantity`</span>
<span class="sd">        Spectral index of the model.</span>
<span class="sd">    reference : `astropy.units.Quantity`</span>
<span class="sd">        Reference energy of the power law.</span>
<span class="sd">    mean : `astropy.units.Quantity`</span>
<span class="sd">        Mean value of the Gaussian.</span>
<span class="sd">    width : `astropy.units.Quantity`</span>
<span class="sd">        Sigma width of the Gaussian line.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;MyCustomSpectralModel&quot;</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="s2">&quot;1e-12 cm-2 s-1 TeV-1&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="s2">&quot;1 TeV&quot;</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;1 TeV&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;0.1 TeV&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
            <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span>
            <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">gauss</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">energy</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">width</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pwl</span> <span class="o">+</span> <span class="n">gauss</span>
</pre></div>
</div>
</div>
<p>It is good practice to also implement a docstring for the model, defining the parameters and also definig a <code class="docutils literal notranslate"><span class="pre">tag</span></code>, which specifies the name of the model for serialisation. Also note that gammapy assumes that all SpectralModel evaluate functions return a flux in unit of <code class="docutils literal notranslate"><span class="pre">&quot;cm-2</span> <span class="pre">s-1</span> <span class="pre">TeV-1&quot;</span></code> (or equivalent dimensions).</p>
<p>This model can now be used as any other spectral model in Gammapy:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_custom_model</span> <span class="o">=</span> <span class="n">MyCustomSpectralModel</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="s2">&quot;3 TeV&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_custom_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MyCustomSpectralModel

   name     value         unit         min    max frozen   error
--------- ---------- -------------- --------- --- ------ ---------
amplitude 1.0000e-12 cm-2 s-1 TeV-1 0.000e+00 nan  False 0.000e+00
    index 2.0000e+00                0.000e+00 nan  False 0.000e+00
reference 1.0000e+00            TeV       nan nan   True 0.000e+00
     mean 3.0000e+00            TeV 0.000e+00 nan  False 0.000e+00
    width 1.0000e-01            TeV 0.000e+00 nan   True 0.000e+00
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_custom_model</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="math notranslate nohighlight">
$$1.1442739 \times 10^{-12} \; \mathrm{\frac{1}{s\,cm^{2}}}$$</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">my_custom_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/gammapy/modeling/models/spectral.py:401: MatplotlibDeprecationWarning: The &#39;nonposx&#39; parameter of __init__() has been renamed &#39;nonpositive&#39; since Matplotlib 3.3; support for the old name will be dropped two minor releases later.
  ax.set_xscale(&#34;log&#34;, nonposx=&#34;clip&#34;)
/home/runner/work/gammapy-docs/gammapy-docs/gammapy/gammapy/modeling/models/spectral.py:402: MatplotlibDeprecationWarning: The &#39;nonposy&#39; parameter of __init__() has been renamed &#39;nonpositive&#39; since Matplotlib 3.3; support for the old name will be dropped two minor releases later.
  ax.set_yscale(&#34;log&#34;, nonposy=&#34;clip&#34;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:xlabel=&#39;Energy [TeV]&#39;, ylabel=&#39;Flux [1 / (cm2 s TeV)]&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_models_83_2.png" src="../_images/tutorials_models_83_2.png" />
</div>
</div>
<p>As a next step we can also register the custom model in the <code class="docutils literal notranslate"><span class="pre">SPECTRAL_MODELS</span></code> registry, so that it becomes available for serilisation:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">SPECTRAL_MODEL_REGISTRY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MyCustomSpectralModel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><span class="n">my_custom_model</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-source&quot;</span><span class="p">)</span>
<span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">([</span><span class="n">model</span><span class="p">])</span>
<span class="n">models</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;my-custom-models.yaml&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>cat my-custom-models.yaml
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
components:
-   name: my-source
    type: SkyModel
    spectral:
        type: MyCustomSpectralModel
        parameters:
        -   name: amplitude
            value: 1.0e-12
            unit: cm-2 s-1 TeV-1
        -   name: index
            value: 2.0
        -   name: reference
            value: 1.0
            unit: TeV
            frozen: true
        -   name: mean
            value: 3.0
            unit: TeV
        -   name: width
            value: 0.1
            unit: TeV
            frozen: true
covariance: my-custom-models_covariance.dat
</pre></div></div>
</div>
<p>Similarly you can also create custom spatial models and add them to the <code class="docutils literal notranslate"><span class="pre">SPATIAL_MODELS</span></code> registry. In that case gammapy assumes that the evaluate function return a normalized quantity in “sr-1” such as the model integral over the whole sky is one.</p>
</div>
<div class="section" id="Models-with-energy-dependent-morphology">
<h2>Models with energy dependent morphology<a class="headerlink" href="#Models-with-energy-dependent-morphology" title="Permalink to this headline">¶</a></h2>
<p>A common science case in the study of extended sources is to probe for energy dependent morphology, in Supernova Remnants or Pulsar Wind Nebulae. Traditionally, this has been done by splitting the data into energy bands and doing individual fits of the morphology in these energy bands.</p>
<p><code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> offers a natural framework to simultaneously model the energy and morphology, e.g. spatial extent described by a parametric model expression with energy dependent parameters.</p>
<p>The models shipped within gammapy use a “factorised” representation of the source model, where the spatial (<span class="math notranslate nohighlight">\(l,b\)</span>), energy (<span class="math notranslate nohighlight">\(E\)</span>) and time (<span class="math notranslate nohighlight">\(t\)</span>) dependence are independent model components and not correlated:</p>
<div class="math notranslate nohighlight">
\[f(l, b, E, t) = F(l, b) \cdot G(E) \cdot H(t)\]</div>
<p>To use full 3D models, ie $f(l, b, E) = F(l, b, E) <span class="math">\cdot `G(E) $, you have to implement your own custom ``SpatialModel`</span>. Note that it is still necessary to multiply by a <code class="docutils literal notranslate"><span class="pre">SpectralModel</span></code>, <span class="math notranslate nohighlight">\(G(E)\)</span> to be dimensionally consistent.</p>
<p>In this example, we create Gaussian Spatial Model with the extension varying with energy. For simplicity, we assume a linear dependence on energy and parameterize this by specifing the extension at 2 energies. You can add more complex dependences, probably motivated by physical models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SpatialModel</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates.angle_utilities</span> <span class="kn">import</span> <span class="n">angular_separation</span>


<span class="k">class</span> <span class="nc">MyCustomGaussianModel</span><span class="p">(</span><span class="n">SpatialModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;My custom Energy Dependent Gaussian model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lon_0, lat_0 : `~astropy.coordinates.Angle`</span>
<span class="sd">        Center position</span>
<span class="sd">    sigma_1TeV : `~astropy.coordinates.Angle`</span>
<span class="sd">        Width of the Gaussian at 1 TeV</span>
<span class="sd">    sigma_10TeV : `~astropy.coordinates.Angle`</span>
<span class="sd">        Width of the Gaussian at 10 TeV</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;MyCustomGaussianModel&quot;</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;lon_0&quot;</span><span class="p">,</span> <span class="s2">&quot;0 deg&quot;</span><span class="p">)</span>
    <span class="n">lat_0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;lat_0&quot;</span><span class="p">,</span> <span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

    <span class="n">sigma_1TeV</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;sigma_1TeV&quot;</span><span class="p">,</span> <span class="s2">&quot;2.0 deg&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sigma_10TeV</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;sigma_10TeV&quot;</span><span class="p">,</span> <span class="s2">&quot;0.2 deg&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_sigma</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">sigma_1TeV</span><span class="p">,</span> <span class="n">sigma_10TeV</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the sigma for a particular energy&quot;&quot;&quot;</span>
        <span class="n">sigmas</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">sigma_1TeV</span><span class="p">,</span> <span class="n">sigma_10TeV</span><span class="p">])</span>
        <span class="n">energy_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>

        <span class="n">log_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigmas</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">log_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">energy_nodes</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;TeV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">log_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">energy</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;TeV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">log_e</span><span class="p">,</span> <span class="n">log_en</span><span class="p">,</span> <span class="n">log_s</span><span class="p">))</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="p">,</span> <span class="n">sigma_1TeV</span><span class="p">,</span> <span class="n">sigma_10TeV</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate custom Gaussian model&quot;&quot;&quot;</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sigma</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">sigma_1TeV</span><span class="p">,</span> <span class="n">sigma_10TeV</span><span class="p">)</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">angular_separation</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="p">)</span>

        <span class="n">exponent</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">sep</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">norm</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">evaluation_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluation radius (`~astropy.coordinates.Angle`).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_1TeV</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_10TeV</span><span class="o">.</span><span class="n">value</span><span class="p">])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Serialisation of this model can be achieved as explained in the previous section. You can now use it as stadard <code class="docutils literal notranslate"><span class="pre">SpatialModel</span></code> in your analysis. Note that this is still a <code class="docutils literal notranslate"><span class="pre">SpatialModel</span></code>, and not a <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code>, so it needs to be multiplied by a <code class="docutils literal notranslate"><span class="pre">SpectralModel</span></code> as before.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">spatial_model</span> <span class="o">=</span> <span class="n">MyCustomGaussianModel</span><span class="p">()</span>
<span class="n">spectral_model</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">()</span>
<span class="n">sky_model</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span>
    <span class="n">spatial_model</span><span class="o">=</span><span class="n">spatial_model</span><span class="p">,</span> <span class="n">spectral_model</span><span class="o">=</span><span class="n">spectral_model</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>To visualise it, we evaluate it on a 3D geom.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_energy_bounds</span><span class="p">(</span>
    <span class="n">energy_min</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy_true&quot;</span>
<span class="p">)</span>
<span class="n">geom</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">5.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">spatial_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">geom</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_models_94_0.png" src="../_images/tutorials_models_94_0.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modeling.html" class="btn btn-neutral float-right" title="Modeling and fitting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="catalog.html" class="btn btn-neutral float-left" title="Source catalogs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, The Gammapy developers
      <span class="lastupdated">
        Last updated on 14 Dec 2020.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>